services:
  - type: web
    name: online-exam-system
    env: managed
    plan: free
    branch: render-deploy
    buildCommand: |
      # Install PHP dependencies
      composer install --no-dev --prefer-dist --no-interaction --optimize-autoloader || true
      # If frontend exists, build it
      if [ -f package.json ]; then npm ci && npm run build || true; fi
      # Ensure APP_KEY exists (will not overwrite if provided via env)
      if [ -z "$APP_KEY" ]; then php artisan key:generate --force || true; fi
    startCommand: |
      # Run migrations (ignore failures if DB not yet provisioned)
      php artisan migrate --force || true
      # Create storage symlink
      php artisan storage:link || true
      # Cache configuration and routes
      php artisan config:cache || true
      php artisan route:cache || true
      # Start the built-in PHP server on the port Render provides
      exec php -S 0.0.0.0:$PORT -t public
